<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      height: 100vh;
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
    }

    .container {
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      text-align: center;
      margin-top: 20px;
    }

    h2 {
      margin-bottom: 20px;
    }

    .inventory-container {
      width: 100%;
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      text-align: center;
      position: fixed;
      bottom: 0;
      left: 0;
      display: none;
    }

    .inventory {
      display: flex;
      justify-content: space-around;
      width: 100%;
      margin-bottom: 20px;
    }

    .food-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    button {
      margin: 10px;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background-color: #007bff;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #0056b3;
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    .bar-container {
      width: 100%;
      background-color: #ddd;
      border-radius: 5px;
      overflow: hidden;
      margin: 10px 0;
    }

    .bar {
      height: 20px;
      transition: width 0.3s, background-color 0.3s;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Welcome <%= user %>!</h1>
    <h2>Your Pet</h2>
    <% let petImage=`/images/${pet.pet_type.toLowerCase()}.png`; %>
    <% if (pet.current_outfit==='Top Hat' ) { %>
    <% petImage=`/images/${pet.pet_type.toLowerCase()}2.png`; %>
    <% } else if (pet.current_outfit==='Sunglasses' ) { %>
    <% petImage=`/images/${pet.pet_type.toLowerCase()}3.png`; %>
    <% } %>
    <img src="<%= petImage %>" alt="<%= pet.pet_type %>">
    <p>Name: <%= pet.pet_name %></p>
    <div class="bar-container">
      <div id="hunger-bar" class="bar"></div>
    </div>
    <p>Hunger: <span id="hunger-value"><%= Math.min(pet.hunger, 100) %></span></p>
    <div class="bar-container">
      <div id="happiness-bar" class="bar"></div>
    </div>
    <p>Happiness: <span id="happiness-value"><%= Math.min(pet.happiness, 100) %></span></p>
    <p>Outfit: <%= pet.current_outfit %></p>
    <p>Personality: <%= pet.personality %></p>
    <p>Coins: <%= pet.coins %></p>
    <p>Hunger Decrease Rate: 
      <% switch (pet.personality) {
        case 'Playful': %> 2 <% break;
        case 'Lazy': %> 3 <% break;
        case 'Curious': %> 1 <% break;
        case 'Energetic': %> 4 <% break;
        case 'Calm': %> 1 <% break;
        case 'Greedy': %> 5 <% break;
        case 'Cheerful': %> 2 <% break;
        case 'Depressed': %> 5 <% break;
        default: %> 2 <% break;
      } %>
    </p>
    <p>Happiness Decrease Rate: 
      <% switch (pet.personality) {
        case 'Playful': %> 1 <% break;
        case 'Lazy': %> 1 <% break;
        case 'Curious': %> 3 <% break;
        case 'Energetic': %> 1 <% break;
        case 'Calm': %> 1 <% break;
        case 'Greedy': %> 2 <% break;
        case 'Cheerful': %> 1 <% break;
        case 'Depressed': %> 10 <% break;
        default: %> 2 <% break;
      } %>
    </p>
    <div class="actions">
      <button type="button" onclick="toggleInventory()" <%= pet.hunger >= 100 ? 'disabled' : '' %>>Feed</button>
      <form action="/pet" method="POST">
        <button type="submit">Pet</button>
      </form>
      <form action="/play" method="POST">
        <button type="submit">Play</button>
      </form>
      <form action="/shop" method="GET">
        <button type="submit">Shop</button>
      </form>
      <form action="/change-outfit" method="POST">
        <select name="outfit" required>
          <option value="default" <%=pet.current_outfit==='default' ? 'selected' : '' %>>Default</option>
          <% ownedOutfits.forEach(outfit=> { %>
          <option value="<%= outfit %>" <%=pet.current_outfit===outfit ? 'selected' : '' %>><%= outfit.charAt(0).toUpperCase() + outfit.slice(1) %>
          </option>
          <% }); %>
        </select>
        <button type="submit">Change Outfit</button>
      </form>
    </div>
    <div id="pet" ondrop="drop(event)" ondragover="allowDrop(event)">
      <h3>Drag food here to feed your pet</h3>
    </div>
  </div>
  <div class="inventory-container" id="inventory-container">
    <h3>Inventory</h3>
    <form action="/feed" method="POST">
      <div class="inventory">
        <% if (pet.inventory && pet.inventory !== '[]') { %>
          <% let inventory = JSON.parse(pet.inventory); %>
          <% inventory.forEach(function(item) { %>
            <div class="food-item">
              <input type="radio" id="<%= item %>" name="food" value="<%= item %>" required>
              <label for="<%= item %>">
                <img src="/images/<%= item.toLowerCase() %>.png" alt="<%= item %>" style="width:50px;height:50px;">
                <%= item %>
              </label>
            </div>
          <% }); %>
        <% } else { %>
          <p>No food items in inventory.</p>
        <% } %>
      </div>
      <button type="submit">Feed</button>
    </form>
  </div>
  <script>
    function toggleInventory() {
      var inventoryContainer = document.getElementById('inventory-container');
      if (inventoryContainer.style.display === 'none' || inventoryContainer.style.display === '') {
        inventoryContainer.style.display = 'block';
      } else {
        inventoryContainer.style.display = 'none';
      }
    }

    function allowDrop(ev) {
      ev.preventDefault();
    }

    function drag(ev) {
      ev.dataTransfer.setData("text", ev.target.getAttribute("data-food"));
    }

    function drop(ev) {
      ev.preventDefault();
      var food = ev.dataTransfer.getData("text");
      fetch('/use-food', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ food: food })
      }).then(response => {
        if (response.ok) {
          location.reload();
        } else {
          alert('Error occurred. Try again.');
        }
      });
    }

    document.querySelectorAll('.food-item').forEach(item => {
      item.addEventListener('dragstart', drag);
    });

    function getColor(value) {
      if (value > 50) {
        const green = 255;
        const red = Math.floor(255 - (value - 50) * 5.1);
        return `rgb(${red}, ${green}, 0)`;
      } else {
        const green = Math.floor(value * 5.1);
        const red = 255;
        return `rgb(${red}, ${green}, 0)`;
      }
    }

    function updateBars() {
      fetch('/pet-status')
        .then(response => response.json())
        .then(data => {
          const hungerValue = data.hunger;
          const happinessValue = data.happiness;

          console.log('Hunger:', hungerValue, 'Happiness:', happinessValue); // Debugging

          document.getElementById('hunger-value').innerText = hungerValue;
          document.getElementById('happiness-value').innerText = happinessValue;

          const hungerBar = document.getElementById('hunger-bar');
          const happinessBar = document.getElementById('happiness-bar');

          hungerBar.style.width = hungerValue + '%';
          hungerBar.style.backgroundColor = getColor(hungerValue);

          happinessBar.style.width = happinessValue + '%';
          happinessBar.style.backgroundColor = getColor(happinessValue);
        })
        .catch(error => console.error('Error fetching pet status:', error)); // Debugging
    }

    updateBars();
    setInterval(updateBars, 1000);
  </script>
</body>

</html>